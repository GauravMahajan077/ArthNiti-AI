<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Health Monitor - ArthNiti</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,500;9..40,700&family=Space+Mono&display=swap" rel="stylesheet">
    <style>
        /* Base styles matching your theme */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0055FF;
            --secondary: #00E5A0;
            --accent: #FFB800;
            --color-background: #FFFDF5;
            --color-surface-primary: #FFFFFF;
            --color-surface-secondary: #FFFDF5;
            --color-text-primary: #1A1A1A;
            --color-text-secondary: #757575;
            --color-shadow-border: #1A1A1A;
            --font-heading: 'DM Sans', sans-serif;
            --font-body: 'Space Mono', monospace;
        }

        [data-theme="dark"] {
            --color-background: #1A1A1A;
            --color-surface-primary: #2C2C2C;
            --color-surface-secondary: #333333;
            --color-text-primary: #FFFDF5;
            --color-text-secondary: #a0a0a0;
            --color-shadow-border: #000000;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--color-background);
            color: var(--color-text-primary);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: var(--color-surface-primary);
            border: 4px solid var(--color-shadow-border);
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 8px 8px 0 var(--color-shadow-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            font-family: var(--font-heading);
            padding: 10px 18px;
            border: 3px solid var(--color-shadow-border);
            background: var(--color-surface-primary);
            color: var(--color-text-primary);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.8rem;
            box-shadow: 4px 4px 0 var(--color-shadow-border);
            transition: all 0.1s;
        }

        .btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--color-shadow-border);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        /* Health Status Card */
        .health-status {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: 6px solid var(--color-shadow-border);
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 12px 12px 0 var(--color-shadow-border);
            color: white;
        }

        .health-title {
            font-family: var(--font-heading);
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .health-score {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }

        .score-big {
            text-align: center;
        }

        .score-number {
            font-family: var(--font-heading);
            font-size: 5rem;
            font-weight: 700;
            line-height: 1;
        }

        .score-label {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 10px;
        }

        .health-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .indicator {
            background: rgba(255,255,255,0.2);
            border: 3px solid rgba(255,255,255,0.3);
            padding: 15px;
            text-align: center;
        }

        .indicator-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .indicator-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Simulator Section */
        .simulator-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .simulator-card {
            background: var(--color-surface-primary);
            border: 4px solid var(--color-shadow-border);
            padding: 30px;
            box-shadow: 8px 8px 0 var(--color-shadow-border);
        }

        .card-title {
            font-family: var(--font-heading);
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-family: var(--font-heading);
            font-size: 0.9rem;
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            font-family: var(--font-body);
            font-size: 1rem;
            background: var(--color-surface-secondary);
            border: 3px solid var(--color-shadow-border);
            color: var(--color-text-primary);
            box-shadow: 4px 4px 0 var(--color-shadow-border);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Slider */
        .slider-container {
            margin-top: 10px;
        }

        .slider {
            width: 100%;
            height: 8px;
            background: var(--color-surface-secondary);
            border: 3px solid var(--color-shadow-border);
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: var(--primary);
            border: 3px solid var(--color-shadow-border);
            cursor: pointer;
        }

        .slider-value {
            display: inline-block;
            background: var(--accent);
            border: 3px solid var(--color-shadow-border);
            padding: 5px 15px;
            font-weight: 700;
            margin-top: 8px;
        }

        /* Prediction Result */
        .prediction-result {
            background: var(--secondary);
            border: 4px solid var(--color-shadow-border);
            padding: 25px;
            margin-top: 20px;
            box-shadow: 6px 6px 0 var(--color-shadow-border);
            color: var(--color-shadow-border);
        }

        .prediction-title {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .score-change {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .score-change.positive {
            color: #00AA00;
        }

        .score-change.negative {
            color: #CC0000;
        }

        /* AI Insights */
        .ai-insights {
            background: var(--color-surface-secondary);
            border: 4px solid var(--color-shadow-border);
            padding: 30px;
            box-shadow: 8px 8px 0 var(--color-shadow-border);
            margin-top: 30px;
        }

        .insight-item {
            background: var(--color-surface-primary);
            border: 3px solid var(--color-shadow-border);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 4px 4px 0 var(--color-shadow-border);
            display: flex;
            align-items: start;
            gap: 15px;
        }

        .insight-icon {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .insight-text {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Timeline */
        .timeline {
            background: var(--color-surface-primary);
            border: 4px solid var(--color-shadow-border);
            padding: 30px;
            box-shadow: 8px 8px 0 var(--color-shadow-border);
            margin-top: 30px;
        }

        .timeline-item {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            position: relative;
        }

        .timeline-item:not(:last-child)::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 40px;
            width: 4px;
            height: calc(100% + 10px);
            background: var(--color-shadow-border);
        }

        .timeline-dot {
            width: 40px;
            height: 40px;
            background: var(--accent);
            border: 4px solid var(--color-shadow-border);
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .timeline-content {
            flex: 1;
            background: var(--color-surface-secondary);
            border: 3px solid var(--color-shadow-border);
            padding: 15px;
        }

        .timeline-title {
            font-family: var(--font-heading);
            font-weight: 700;
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .simulator-section {
                grid-template-columns: 1fr;
            }
            
            .health-score {
                flex-direction: column;
            }
            
            .score-number {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💪 Financial Health Monitor</h1>
            <div class="header-actions">
                <button class="btn" onclick="window.history.back()">← BACK</button>
                <button class="btn" id="themeToggle">🌙</button>
            </div>
        </div>

        <!-- Current Health Status -->
        <div class="health-status">
            <div class="health-title">
                <span>🏥</span>
                <span>YOUR CURRENT FINANCIAL HEALTH</span>
            </div>
            <div class="health-score">
                <div class="score-big">
                    <div class="score-number" id="currentScore">720</div>
                    <div class="score-label">CURRENT SCORE</div>
                </div>
                <div class="health-indicators">
                    <div class="indicator">
                        <div class="indicator-value" id="healthGrade">B+</div>
                        <div class="indicator-label">HEALTH GRADE</div>
                    </div>
                    <div class="indicator">
                        <div class="indicator-value" id="riskLevel">LOW</div>
                        <div class="indicator-label">RISK LEVEL</div>
                    </div>
                    <div class="indicator">
                        <div class="indicator-value" id="trendIndicator">↗ +15</div>
                        <div class="indicator-label">30-DAY TREND</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- What-if Simulator -->
        <div class="simulator-section">
            <div class="simulator-card">
                <div class="card-title">
                    <span>🎯</span>
                    <span>WHAT-IF SIMULATOR</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label">IF I IMPROVE RENT PAYMENT TO:</label>
                    <select class="form-select" id="simRentHistory">
                        <option value="excellent">Excellent (12+ months on-time)</option>
                        <option value="good" selected>Good (6-11 months on-time)</option>
                        <option value="fair">Fair (3-5 months on-time)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">IF I INCREASE SAVINGS RATE TO:</label>
                    <div class="slider-container">
                        <input type="range" min="5" max="30" value="15" class="slider" id="simSavingsRate">
                        <span class="slider-value" id="savingsDisplay">15%</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">IF I REDUCE OVERDRAFTS TO:</label>
                    <div class="slider-container">
                        <input type="range" min="0" max="10" value="2" class="slider" id="simOverdrafts">
                        <span class="slider-value" id="overdraftsDisplay">2</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">IF I IMPROVE EMPLOYMENT TO:</label>
                    <select class="form-select" id="simEmployment">
                        <option value="high">High (2+ years same employer)</option>
                        <option value="medium" selected>Medium (1-2 years)</option>
                        <option value="low">Low (less than 1 year)</option>
                    </select>
                </div>

                <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="calculatePrediction()">
                    SIMULATE CHANGES →
                </button>
            </div>

            <div class="simulator-card">
                <div class="card-title">
                    <span>🔮</span>
                    <span>PREDICTION RESULT</span>
                </div>

                <div id="predictionArea">
                    <p style="text-align: center; padding: 40px; color: var(--color-text-secondary);">
                        Adjust the parameters on the left and click "SIMULATE CHANGES" to see your predicted score.
                    </p>
                </div>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="ai-insights">
            <div class="card-title">
                <span>🤖</span>
                <span>AI HEALTH INSIGHTS</span>
            </div>
            <div id="insightsList">
                <div class="insight-item">
                    <div class="insight-icon">💚</div>
                    <div class="insight-text">
                        <strong>Positive Trend:</strong> Your score improved by 15 points in the last 30 days due to consistent rent payments and reduced overdrafts.
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">⚠️</div>
                    <div class="insight-text">
                        <strong>Watch Out:</strong> Your savings rate is below the recommended 20%. Increasing it could boost your score by 25-30 points.
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">🎯</div>
                    <div class="insight-text">
                        <strong>Quick Win:</strong> Maintaining zero overdrafts for 3 more months could push your score above 750 (Excellent range).
                    </div>
                </div>
            </div>
        </div>

        <!-- 90-Day Roadmap -->
        <div class="timeline">
            <div class="card-title">
                <span>🗺️</span>
                <span>YOUR 90-DAY IMPROVEMENT ROADMAP</span>
            </div>
            <div class="timeline-item">
                <div class="timeline-dot">30</div>
                <div class="timeline-content">
                    <div class="timeline-title">Days 1-30: Build Foundation</div>
                    <p>✓ Pay all bills on time<br>✓ Reduce overdrafts to zero<br>✓ Target: +10-15 points</p>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-dot">60</div>
                <div class="timeline-content">
                    <div class="timeline-title">Days 31-60: Optimize Habits</div>
                    <p>✓ Increase savings rate to 20%<br>✓ Maintain payment streak<br>✓ Target: +15-20 points</p>
                </div>
            </div>
            <div class="timeline-item">
                <div class="timeline-dot">90</div>
                <div class="timeline-content">
                    <div class="timeline-title">Days 61-90: Reach Excellence</div>
                    <p>✓ Stabilize employment record<br>✓ Build emergency fund<br>✓ Target: Score 750+ (Excellent)</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme toggle
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.addEventListener('click', () => {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            html.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
            themeToggle.textContent = current === 'dark' ? '🌙' : '☀️';
        });

        // Slider updates
        const savingsSlider = document.getElementById('simSavingsRate');
        const savingsDisplay = document.getElementById('savingsDisplay');
        savingsSlider.addEventListener('input', (e) => {
            savingsDisplay.textContent = e.target.value + '%';
        });

        const overdraftsSlider = document.getElementById('simOverdrafts');
        const overdraftsDisplay = document.getElementById('overdraftsDisplay');
        overdraftsSlider.addEventListener('input', (e) => {
            overdraftsDisplay.textContent = e.target.value;
        });

        // Prediction calculation
        function calculatePrediction() {
            const rentHistory = document.getElementById('simRentHistory').value;
            const savingsRate = parseInt(document.getElementById('simSavingsRate').value);
            const overdrafts = parseInt(document.getElementById('simOverdrafts').value);
            const employment = document.getElementById('simEmployment').value;

            // Simple scoring logic (matches your scoring_engine.py logic)
            let predictedScore = 300;
            
            // Rent history impact
            const rentScores = {excellent: 100, good: 75, fair: 40};
            predictedScore += (rentScores[rentHistory] || 0) * 1.925;
            
            // Savings rate impact
            let savingsScore = 0;
            if (savingsRate >= 20) savingsScore = 100;
            else if (savingsRate >= 15) savingsScore = 75;
            else if (savingsRate >= 10) savingsScore = 50;
            else savingsScore = 25;
            predictedScore += savingsScore * 0.5;
            
            // Overdrafts impact (negative)
            predictedScore -= overdrafts * 8;
            
            // Employment impact
            const empScores = {high: 100, medium: 70, low: 30};
            predictedScore += (empScores[employment] || 0) * 1.1;
            
            // Add base scores
            predictedScore += 150; // Utility, other factors

            predictedScore = Math.min(850, Math.max(300, Math.round(predictedScore)));

            const currentScore = parseInt(document.getElementById('currentScore').textContent);
            const change = predictedScore - currentScore;
            const changeClass = change >= 0 ? 'positive' : 'negative';
            const changeSymbol = change >= 0 ? '+' : '';

            // Display result
            const predictionArea = document.getElementById('predictionArea');
            predictionArea.innerHTML = `
                <div class="prediction-result">
                    <div class="prediction-title">📊 PREDICTED NEW SCORE</div>
                    <div class="score-change ${changeClass}">${predictedScore}</div>
                    <div style="font-size: 1.5rem; margin: 15px 0;">
                        Change: <strong>${changeSymbol}${change} points</strong>
                    </div>
                    <p style="margin-top: 20px; line-height: 1.6;">
                        ${getRecommendation(change, predictedScore)}
                    </p>
                </div>
            `;
        }

        function getRecommendation(change, score) {
            if (change >= 50) {
                return "🎉 Excellent! These changes could significantly boost your score. You're on track to reach the 'Excellent' rating!";
            } else if (change >= 25) {
                return "👍 Great improvement! These changes will noticeably improve your creditworthiness. Keep it up!";
            } else if (change >= 10) {
                return "📈 Good progress! Small consistent improvements add up. Consider additional changes for bigger impact.";
            } else if (change >= 0) {
                return "💡 Slight improvement. Try adjusting more parameters to see larger score gains.";
            } else {
                return "⚠️ This combination might lower your score. Try improving at least 2-3 factors together.";
            }
        }

        // Load saved data from sessionStorage when page loads
        window.addEventListener('DOMContentLoaded', () => {
            const savedScore = sessionStorage.getItem('currentScore');
            const savedData = sessionStorage.getItem('userData');
            
            console.log('Financial Health Monitor loaded');
            console.log('Saved Score:', savedScore);
            console.log('Saved Data:', savedData);
            
            if (savedScore) {
                document.getElementById('currentScore').textContent = savedScore;
                
                // Update health grade and risk based on score
                const score = parseInt(savedScore);
                const gradeEl = document.getElementById('healthGrade');
                const riskEl = document.getElementById('riskLevel');
                
                if (score >= 800) {
                    gradeEl.textContent = 'A+';
                    riskEl.textContent = 'VERY LOW';
                } else if (score >= 740) {
                    gradeEl.textContent = 'A';
                    riskEl.textContent = 'LOW';
                } else if (score >= 670) {
                    gradeEl.textContent = 'B+';
                    riskEl.textContent = 'MEDIUM';
                } else if (score >= 580) {
                    gradeEl.textContent = 'B';
                    riskEl.textContent = 'MEDIUM-HIGH';
                } else {
                    gradeEl.textContent = 'C';
                    riskEl.textContent = 'HIGH';
                }
            }
            
            if (savedData) {
                const userData = JSON.parse(savedData);
                console.log('Parsed User Data:', userData);
                
                // Pre-fill simulator with user's current data
                document.getElementById('simRentHistory').value = userData.rentHistory || 'good';
                document.getElementById('simEmployment').value = userData.employmentStability || 'medium';
                
                const savingsRate = parseFloat(userData.savingsRate || 0.15) * 100;
                document.getElementById('simSavingsRate').value = savingsRate;
                document.getElementById('savingsDisplay').textContent = savingsRate + '%';
                
                document.getElementById('simOverdrafts').value = userData.overdrafts || 2;
                document.getElementById('overdraftsDisplay').textContent = userData.overdrafts || 2;
            }
        });
    </script>
</body>
</html>